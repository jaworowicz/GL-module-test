
<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do Kanban - Mockup</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            color: #e2e8f0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(30, 41, 59, 0.7);
            border-radius: 12px;
            border: 1px solid rgb(51, 65, 85);
        }

        .header h1 {
            color: #34d399;
            font-size: 2rem;
        }

        .controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #2563eb;
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
        }

        .btn-secondary {
            background: #64748b;
            color: white;
        }

        .btn-secondary:hover {
            background: #475569;
        }

        .custom-select {
            padding: 8px 12px;
            background: #374151;
            border: 1px solid #4b5563;
            border-radius: 6px;
            color: #e5e7eb;
        }

        .kanban-board {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .kanban-column {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgb(51, 65, 85);
            border-radius: 12px;
            padding: 20px;
            min-height: 500px;
        }

        .column-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgb(51, 65, 85);
        }

        .column-title {
            font-size: 1.2rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .task-count {
            background: #4f46e5;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
        }

        .task-card {
            background: rgba(51, 65, 85, 0.7);
            border: 1px solid rgb(75, 85, 99);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            cursor: grab;
            transition: all 0.3s ease;
            position: relative;
        }

        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .task-card.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .task-priority {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .priority-high { background: #ef4444; }
        .priority-medium { background: #f59e0b; }
        .priority-low { background: #10b981; }

        .task-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: #f8fafc;
        }

        .task-description {
            font-size: 0.9rem;
            color: #cbd5e1;
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .task-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: #94a3b8;
        }

        .task-assignee {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .assignee-type {
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
        }

        .type-global { background: #7c3aed; color: white; }
        .type-user { background: #059669; color: white; }
        .type-self { background: #dc2626; color: white; }

        .task-actions {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }

        .task-action-btn {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.7rem;
            transition: all 0.2s ease;
        }

        .btn-edit {
            background: #3b82f6;
            color: white;
        }

        .btn-delete {
            background: #ef4444;
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #1e293b;
            border: 1px solid rgb(51, 65, 85);
            border-radius: 12px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.5rem;
            color: #34d399;
        }

        .close-btn {
            background: none;
            border: none;
            color: #94a3b8;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            color: #f1f5f9;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 10px;
            background: #374151;
            border: 1px solid #4b5563;
            border-radius: 6px;
            color: #e5e7eb;
            font-family: inherit;
        }

        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }

        .widget-container {
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid rgb(51, 65, 85);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .widget-title {
            color: #34d399;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .widget-tasks {
            max-height: 300px;
            overflow-y: auto;
        }

        .widget-task {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            margin-bottom: 8px;
            background: rgba(51, 65, 85, 0.5);
            border-radius: 6px;
        }

        .widget-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .widget-task-text {
            flex: 1;
            font-size: 0.9rem;
        }

        .completed {
            text-decoration: line-through;
            opacity: 0.6;
        }

        .drop-zone {
            min-height: 50px;
            border: 2px dashed transparent;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .drop-zone.drag-over {
            border-color: #34d399;
            background: rgba(52, 211, 153, 0.1);
        }

        @media (max-width: 768px) {
            .kanban-board {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1><i class="fas fa-tasks"></i> To-Do Kanban Board</h1>
            <div class="controls">
                <select id="locationFilter" class="custom-select">
                    <option value="all">Wszystkie lokalizacje</option>
                    <option value="20004014">BAZA 20004014</option>
                    <option value="20004015">BAZA 20004015</option>
                </select>
                <select id="userFilter" class="custom-select">
                    <option value="all">Wszyscy użytkownicy</option>
                    <option value="1">Jakub Jaworowicz</option>
                    <option value="2">Anna Kowalska</option>
                    <option value="3">Piotr Nowak</option>
                </select>
                <button class="btn btn-primary" onclick="openTaskModal()">
                    <i class="fas fa-plus"></i> Dodaj zadanie
                </button>
            </div>
        </header>

        <div class="kanban-board">
            <div class="kanban-column" data-status="new">
                <div class="column-header">
                    <div class="column-title">
                        <i class="fas fa-inbox"></i>
                        Nowe
                        <span class="task-count" id="new-count">0</span>
                    </div>
                </div>
                <div class="drop-zone" id="new-tasks"></div>
            </div>

            <div class="kanban-column" data-status="in-progress">
                <div class="column-header">
                    <div class="column-title">
                        <i class="fas fa-play"></i>
                        W toku
                        <span class="task-count" id="in-progress-count">0</span>
                    </div>
                </div>
                <div class="drop-zone" id="in-progress-tasks"></div>
            </div>

            <div class="kanban-column" data-status="returned">
                <div class="column-header">
                    <div class="column-title">
                        <i class="fas fa-undo"></i>
                        Zwrócone
                        <span class="task-count" id="returned-count">0</span>
                    </div>
                </div>
                <div class="drop-zone" id="returned-tasks"></div>
            </div>

            <div class="kanban-column" data-status="completed">
                <div class="column-header">
                    <div class="column-title">
                        <i class="fas fa-check"></i>
                        Zakończone
                        <span class="task-count" id="completed-count">0</span>
                    </div>
                </div>
                <div class="drop-zone" id="completed-tasks"></div>
            </div>
        </div>

        <!-- Widget responsywny -->
        <div class="widget-container">
            <h3 class="widget-title"><i class="fas fa-list-check"></i> Moje zadania do wykonania</h3>
            <div class="widget-tasks" id="widget-tasks"></div>
        </div>
    </div>

    <!-- Modal dodawania/edycji zadania -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Dodaj nowe zadanie</h2>
                <button type="button" class="close-btn" onclick="closeTaskModal()">&times;</button>
            </div>
            <form id="taskForm">
                <div class="form-group">
                    <label class="form-label">Tytuł zadania *</label>
                    <input type="text" id="taskTitle" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Opis</label>
                    <textarea id="taskDescription" class="form-textarea"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Typ przypisania *</label>
                    <select id="taskAssignmentType" class="form-select" required onchange="toggleUserSelect()">
                        <option value="">Wybierz typ</option>
                        <option value="global">Globalne (dla wszystkich w lokalizacji)</option>
                        <option value="user">Dla konkretnego użytkownika</option>
                        <option value="self">Tylko dla siebie</option>
                    </select>
                </div>
                <div class="form-group" id="userSelectGroup" style="display: none;">
                    <label class="form-label">Użytkownik</label>
                    <select id="taskAssignedUser" class="form-select">
                        <option value="1">Jakub Jaworowicz</option>
                        <option value="2">Anna Kowalska</option>
                        <option value="3">Piotr Nowak</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Lokalizacja</label>
                    <select id="taskLocation" class="form-select">
                        <option value="20004014">BAZA 20004014</option>
                        <option value="20004015">BAZA 20004015</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Priorytet</label>
                    <select id="taskPriority" class="form-select">
                        <option value="low">Niski</option>
                        <option value="medium">Średni</option>
                        <option value="high">Wysoki</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select id="taskStatus" class="form-select">
                        <option value="new">Nowe</option>
                        <option value="in-progress">W toku</option>
                        <option value="returned">Zwrócone</option>
                        <option value="completed">Zakończone</option>
                    </select>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Zapisz zadanie
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeTaskModal()">
                        <i class="fas fa-times"></i> Anuluj
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Globalne zmienne
        let tasks = [];
        let editingTaskId = null;
        let currentUser = 1; // Symulacja aktualnego użytkownika

        // Inicjalizacja
        document.addEventListener('DOMContentLoaded', function() {
            loadTasks();
            renderTasks();
            renderWidget();
            setupDragAndDrop();
            setupFilters();
        });

        // Zarządzanie zadaniami
        function loadTasks() {
            const savedTasks = localStorage.getItem('kanban_tasks');
            if (savedTasks) {
                tasks = JSON.parse(savedTasks);
            } else {
                // Przykładowe zadania
                tasks = [
                    {
                        id: 1,
                        title: 'Sprawdzenie sprzętu technicznego',
                        description: 'Kontrola stanu technicznego urządzeń w lokalizacji',
                        assignmentType: 'global',
                        assignedUser: null,
                        location: '20004014',
                        priority: 'high',
                        status: 'new',
                        createdBy: 1,
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 2,
                        title: 'Przygotowanie raportu miesięcznego',
                        description: 'Sporządzenie raportu z wyników za bieżący miesiąc',
                        assignmentType: 'user',
                        assignedUser: 2,
                        location: '20004014',
                        priority: 'medium',
                        status: 'in-progress',
                        createdBy: 1,
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 3,
                        title: 'Aktualizacja bazy klientów',
                        description: 'Weryfikacja i aktualizacja danych kontaktowych',
                        assignmentType: 'self',
                        assignedUser: 1,
                        location: '20004014',
                        priority: 'low',
                        status: 'completed',
                        createdBy: 1,
                        createdAt: new Date().toISOString()
                    }
                ];
                saveTasks();
            }
        }

        function saveTasks() {
            localStorage.setItem('kanban_tasks', JSON.stringify(tasks));
        }

        function renderTasks() {
            const columns = {
                'new': document.getElementById('new-tasks'),
                'in-progress': document.getElementById('in-progress-tasks'),
                'returned': document.getElementById('returned-tasks'),
                'completed': document.getElementById('completed-tasks')
            };

            // Wyczyść kolumny
            Object.values(columns).forEach(column => {
                column.innerHTML = '';
            });

            // Filtruj zadania
            const filteredTasks = getFilteredTasks();

            // Renderuj zadania
            filteredTasks.forEach(task => {
                const taskElement = createTaskElement(task);
                columns[task.status].appendChild(taskElement);
            });

            // Aktualizuj liczniki
            updateTaskCounts();
        }

        function getFilteredTasks() {
            const locationFilter = document.getElementById('locationFilter').value;
            const userFilter = document.getElementById('userFilter').value;

            return tasks.filter(task => {
                // Filtr lokalizacji
                if (locationFilter !== 'all' && task.location !== locationFilter) {
                    return false;
                }

                // Filtr użytkownika
                if (userFilter !== 'all') {
                    const userId = parseInt(userFilter);
                    if (task.assignmentType === 'user' && task.assignedUser !== userId) {
                        return false;
                    }
                    if (task.assignmentType === 'self' && task.assignedUser !== userId) {
                        return false;
                    }
                }

                return true;
            });
        }

        function createTaskElement(task) {
            const taskDiv = document.createElement('div');
            taskDiv.className = 'task-card';
            taskDiv.draggable = true;
            taskDiv.dataset.taskId = task.id;

            const assignmentTypeClass = `type-${task.assignmentType}`;
            const assignmentTypeText = {
                'global': 'Globalne',
                'user': 'Użytkownik',
                'self': 'Własne'
            }[task.assignmentType];

            const userName = task.assignedUser ? getUserName(task.assignedUser) : 'Wszyscy';

            taskDiv.innerHTML = `
                <div class="task-priority priority-${task.priority}"></div>
                <div class="task-title">${task.title}</div>
                <div class="task-description">${task.description}</div>
                <div class="task-meta">
                    <div class="task-assignee">
                        <span class="assignee-type ${assignmentTypeClass}">${assignmentTypeText}</span>
                        <span>${userName}</span>
                    </div>
                    <div>ID: ${task.location}</div>
                </div>
                <div class="task-actions">
                    <button class="task-action-btn btn-edit" onclick="editTask(${task.id})">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="task-action-btn btn-delete" onclick="deleteTask(${task.id})">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;

            return taskDiv;
        }

        function getUserName(userId) {
            const users = {
                1: 'Jakub Jaworowicz',
                2: 'Anna Kowalska',
                3: 'Piotr Nowak'
            };
            return users[userId] || 'Nieznany';
        }

        function updateTaskCounts() {
            const filteredTasks = getFilteredTasks();
            const counts = {
                'new': 0,
                'in-progress': 0,
                'returned': 0,
                'completed': 0
            };

            filteredTasks.forEach(task => {
                counts[task.status]++;
            });

            Object.keys(counts).forEach(status => {
                const countElement = document.getElementById(`${status}-count`);
                if (countElement) {
                    countElement.textContent = counts[status];
                }
            });
        }

        // Modal zarządzanie
        function openTaskModal(taskId = null) {
            editingTaskId = taskId;
            const modal = document.getElementById('taskModal');
            const title = document.getElementById('modalTitle');
            
            if (taskId) {
                title.textContent = 'Edytuj zadanie';
                const task = tasks.find(t => t.id === taskId);
                if (task) {
                    document.getElementById('taskTitle').value = task.title;
                    document.getElementById('taskDescription').value = task.description;
                    document.getElementById('taskAssignmentType').value = task.assignmentType;
                    document.getElementById('taskAssignedUser').value = task.assignedUser || '';
                    document.getElementById('taskLocation').value = task.location;
                    document.getElementById('taskPriority').value = task.priority;
                    document.getElementById('taskStatus').value = task.status;
                    toggleUserSelect();
                }
            } else {
                title.textContent = 'Dodaj nowe zadanie';
                document.getElementById('taskForm').reset();
            }
            
            modal.style.display = 'block';
        }

        function closeTaskModal() {
            document.getElementById('taskModal').style.display = 'none';
            editingTaskId = null;
        }

        function toggleUserSelect() {
            const assignmentType = document.getElementById('taskAssignmentType').value;
            const userSelectGroup = document.getElementById('userSelectGroup');
            
            if (assignmentType === 'user') {
                userSelectGroup.style.display = 'block';
            } else {
                userSelectGroup.style.display = 'none';
            }
        }

        // Obsługa formularza
        document.getElementById('taskForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                title: document.getElementById('taskTitle').value,
                description: document.getElementById('taskDescription').value,
                assignmentType: document.getElementById('taskAssignmentType').value,
                assignedUser: document.getElementById('taskAssignedUser').value || null,
                location: document.getElementById('taskLocation').value,
                priority: document.getElementById('taskPriority').value,
                status: document.getElementById('taskStatus').value
            };

            if (formData.assignmentType === 'self') {
                formData.assignedUser = currentUser;
            } else if (formData.assignmentType === 'global') {
                formData.assignedUser = null;
            } else if (formData.assignmentType === 'user') {
                formData.assignedUser = parseInt(formData.assignedUser);
            }

            if (editingTaskId) {
                // Edycja zadania
                const taskIndex = tasks.findIndex(t => t.id === editingTaskId);
                if (taskIndex !== -1) {
                    tasks[taskIndex] = { ...tasks[taskIndex], ...formData };
                }
            } else {
                // Dodanie nowego zadania
                const newTask = {
                    id: Date.now(),
                    ...formData,
                    createdBy: currentUser,
                    createdAt: new Date().toISOString()
                };
                tasks.push(newTask);
            }

            saveTasks();
            renderTasks();
            renderWidget();
            closeTaskModal();
        });

        function editTask(taskId) {
            openTaskModal(taskId);
        }

        function deleteTask(taskId) {
            if (confirm('Czy na pewno chcesz usunąć to zadanie?')) {
                tasks = tasks.filter(t => t.id !== taskId);
                saveTasks();
                renderTasks();
                renderWidget();
            }
        }

        // Drag & Drop
        function setupDragAndDrop() {
            const columns = document.querySelectorAll('.drop-zone');
            
            columns.forEach(column => {
                column.addEventListener('dragover', handleDragOver);
                column.addEventListener('drop', handleDrop);
                column.addEventListener('dragenter', handleDragEnter);
                column.addEventListener('dragleave', handleDragLeave);
            });

            document.addEventListener('dragstart', handleDragStart);
            document.addEventListener('dragend', handleDragEnd);
        }

        function handleDragStart(e) {
            if (e.target.classList.contains('task-card')) {
                e.target.classList.add('dragging');
                e.dataTransfer.setData('text/plain', e.target.dataset.taskId);
            }
        }

        function handleDragEnd(e) {
            if (e.target.classList.contains('task-card')) {
                e.target.classList.remove('dragging');
            }
        }

        function handleDragOver(e) {
            e.preventDefault();
        }

        function handleDragEnter(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            
            const taskId = parseInt(e.dataTransfer.getData('text/plain'));
            const newStatus = e.currentTarget.id.replace('-tasks', '');
            
            const task = tasks.find(t => t.id === taskId);
            if (task && task.status !== newStatus) {
                task.status = newStatus;
                saveTasks();
                renderTasks();
                renderWidget();
            }
        }

        // Widget
        function renderWidget() {
            const widgetContainer = document.getElementById('widget-tasks');
            const myTasks = tasks.filter(task => {
                return (task.assignmentType === 'self' && task.assignedUser === currentUser) ||
                       (task.assignmentType === 'user' && task.assignedUser === currentUser) ||
                       (task.assignmentType === 'global');
            }).filter(task => task.status !== 'completed');

            widgetContainer.innerHTML = '';

            if (myTasks.length === 0) {
                widgetContainer.innerHTML = '<p style="color: #94a3b8; text-align: center;">Brak zadań do wykonania</p>';
                return;
            }

            myTasks.forEach(task => {
                const taskDiv = document.createElement('div');
                taskDiv.className = 'widget-task';
                
                taskDiv.innerHTML = `
                    <input type="checkbox" class="widget-checkbox" ${task.status === 'completed' ? 'checked' : ''} 
                           onchange="toggleTaskCompletion(${task.id}, this.checked)">
                    <div class="widget-task-text ${task.status === 'completed' ? 'completed' : ''}">
                        <strong>${task.title}</strong>
                        <br><small>${task.description}</small>
                    </div>
                    <span class="assignee-type type-${task.assignmentType}">${task.assignmentType}</span>
                `;
                
                widgetContainer.appendChild(taskDiv);
            });
        }

        function toggleTaskCompletion(taskId, isCompleted) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.status = isCompleted ? 'completed' : 'new';
                saveTasks();
                renderTasks();
                renderWidget();
            }
        }

        // Filtry
        function setupFilters() {
            document.getElementById('locationFilter').addEventListener('change', renderTasks);
            document.getElementById('userFilter').addEventListener('change', renderTasks);
        }

        // Zamykanie modala przy kliknięciu na tło
        window.onclick = function(event) {
            const modal = document.getElementById('taskModal');
            if (event.target === modal) {
                closeTaskModal();
            }
        }
    </script>
</body>
</html>
