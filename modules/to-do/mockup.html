<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do Kanban - Mockup</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(-45deg, #0f2027, #203a43, #2c5364, #1c3d52) !important;
            background-size: 400% 400% !important;
            animation: gradientBG 15s ease infinite !important;
            color: #e2e8f0;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }
        
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Animowane tło */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(52, 211, 153, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(168, 85, 247, 0.05) 0%, transparent 50%);
            animation: backgroundFloat 20s ease-in-out infinite;
            z-index: -1;
        }

        @keyframes backgroundFloat {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(30px, -30px) rotate(120deg); }
            66% { transform: translate(-20px, 20px) rotate(240deg); }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(30, 41, 59, 0.8);
            border-radius: 12px;
            border: 1px solid rgb(51, 65, 85);
            backdrop-filter: blur(10px);
            flex-wrap: wrap;
            gap: 15px;
        }

        .header h1 {
            color: #34d399;
            font-size: 2rem;
            flex: 1;
            min-width: 250px;
        }

        .controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            min-width: 300px;
        }

        .btn {
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
            min-width: 44px;
            min-height: 44px;
            justify-content: center;
        }

        .btn-primary {
            background: #2563eb;
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #64748b;
            color: white;
        }

        .btn-secondary:hover {
            background: #475569;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .custom-select {
            padding: 12px 16px;
            background: #374151;
            border: 1px solid #4b5563;
            border-radius: 6px;
            color: #e5e7eb;
            min-width: 150px;
            min-height: 44px;
        }

        .kanban-board {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .kanban-column {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgb(51, 65, 85);
            border-radius: 12px;
            padding: 20px;
            min-height: 500px;
            backdrop-filter: blur(10px);
        }

        .column-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgb(51, 65, 85);
        }

        .column-title {
            font-size: 1.2rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .task-count {
            background: #4f46e5;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
        }

        .task-card {
            background: rgba(51, 65, 85, 0.8);
            border: 1px solid rgb(75, 85, 99);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            cursor: grab;
            transition: all 0.3s ease;
            position: relative;
            backdrop-filter: blur(5px);
            touch-action: none;
        }

        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .task-card.dragging {
            opacity: 0.7;
            transform: rotate(3deg) scale(1.05);
            z-index: 1000;
        }

        .task-card.due-today {
            border-left: 4px solid #f59e0b;
            background: rgba(245, 158, 11, 0.1);
        }

        .task-card.due-overdue {
            border-left: 4px solid #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }

        .task-priority {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .priority-high { background: #ef4444; }
        .priority-medium { background: #f59e0b; }
        .priority-low { background: #10b981; }

        .task-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: #f8fafc;
            padding-right: 20px;
        }

        .task-description {
            font-size: 0.9rem;
            color: #cbd5e1;
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .task-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: #94a3b8;
            flex-wrap: wrap;
            gap: 5px;
        }

        .task-assignee {
            display: flex;
            align-items: center;
            gap: 5px;
            flex-wrap: wrap;
        }

        .assignee-type {
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            white-space: nowrap;
        }

        .type-global { background: #7c3aed; color: white; }
        .type-user { background: #059669; color: white; }
        .type-self { background: #dc2626; color: white; }

        .task-due-date {
            font-size: 0.7rem;
            color: #94a3b8;
            margin-top: 5px;
        }

        .task-due-today {
            color: #f59e0b;
            font-weight: bold;
        }

        .task-due-overdue {
            color: #ef4444;
            font-weight: bold;
        }

        .task-actions {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }

        .task-action-btn {
            padding: 6px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.7rem;
            transition: all 0.2s ease;
            min-width: 32px;
            min-height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            position: relative;
        }

        .btn-edit {
            background: #3b82f6;
            color: white;
        }

        .btn-delete {
            background: #ef4444;
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(30, 41, 59, 0.95);
            border: 1px solid rgb(51, 65, 85);
            border-radius: 12px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            backdrop-filter: blur(10px);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.5rem;
            color: #34d399;
        }

        .close-btn {
            background: none;
            border: none;
            color: #94a3b8;
            font-size: 1.5rem;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            color: #f1f5f9;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 12px;
            background: #374151;
            border: 1px solid #4b5563;
            border-radius: 6px;
            color: #e5e7eb;
            font-family: inherit;
            min-height: 44px;
        }

        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }

        .widget-container {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgb(51, 65, 85);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .widget-title {
            color: #34d399;
            margin-bottom: 15px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .widget-tasks {
            max-height: 300px;
            overflow-y: auto;
        }

        .widget-task {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(51, 65, 85, 0.6);
            border-radius: 8px;
            border: 1px solid rgba(75, 85, 99, 0.5);
            transition: all 0.2s ease;
        }

        .widget-task:hover {
            background: rgba(51, 65, 85, 0.8);
            transform: translateX(4px);
        }

        .widget-task.due-today {
            border-left: 3px solid #f59e0b;
            background: rgba(245, 158, 11, 0.1);
        }

        .widget-task.due-overdue {
            border-left: 3px solid #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }

        /* Custom Checkbox */
        .custom-checkbox {
            position: relative;
            display: inline-block;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .custom-checkbox input {
            opacity: 0;
            position: absolute;
            width: 100%;
            height: 100%;
            margin: 0;
            cursor: pointer;
        }

        .checkbox-checkmark {
            position: absolute;
            top: 0;
            left: 0;
            width: 20px;
            height: 20px;
            background: rgba(55, 65, 81, 0.8);
            border: 2px solid #4b5563;
            border-radius: 4px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .custom-checkbox input:checked + .checkbox-checkmark {
            background: #34d399;
            border-color: #34d399;
            transform: scale(1.1);
        }

        .checkbox-checkmark::after {
            content: '';
            position: absolute;
            display: none;
            width: 6px;
            height: 10px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }

        .custom-checkbox input:checked + .checkbox-checkmark::after {
            display: block;
        }

        .widget-task-text {
            flex: 1;
            font-size: 0.9rem;
        }

        .widget-task-text strong {
            color: #f8fafc;
            display: block;
            margin-bottom: 4px;
        }

        .widget-task-text small {
            color: #cbd5e1;
            line-height: 1.3;
        }

        .widget-task-due {
            font-size: 0.7rem;
            color: #94a3b8;
            margin-top: 2px;
        }

        .widget-task-due.due-today {
            color: #f59e0b;
            font-weight: bold;
        }

        .widget-task-due.due-overdue {
            color: #ef4444;
            font-weight: bold;
        }

        .completed {
            text-decoration: line-through;
            opacity: 0.6;
        }

        .drop-zone {
            min-height: 50px;
            border: 2px dashed transparent;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .drop-zone.drag-over {
            border-color: #34d399;
            background: rgba(52, 211, 153, 0.1);
        }

        /* Confirmation Modal */
        .confirm-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2100;
            backdrop-filter: blur(5px);
        }

        .confirm-modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(30, 41, 59, 0.95);
            border: 1px solid rgb(51, 65, 85);
            border-radius: 12px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            backdrop-filter: blur(10px);
            text-align: center;
        }

        .confirm-modal-title {
            color: #ef4444;
            font-size: 1.3rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .confirm-modal-text {
            color: #e2e8f0;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .confirm-modal-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        /* Admin Widget Styles */
        .admin-widget-container {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgb(51, 65, 85);
            border-radius: 12px;
            padding: 20px;
            margin-top: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            display: none; /* Domyślnie ukryty, pokazany dla admina */
        }

        .admin-widget-title {
            color: #34d399;
            margin-bottom: 20px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 2px solid rgb(51, 65, 85);
            padding-bottom: 10px;
        }

        .admin-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .admin-stat-card {
            background: rgba(51, 65, 85, 0.6);
            border: 1px solid rgba(75, 85, 99, 0.5);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            transition: all 0.2s ease;
        }

        .admin-stat-card:hover {
            background: rgba(51, 65, 85, 0.8);
            transform: translateY(-2px);
        }

        .admin-stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }

        .admin-stat-label {
            font-size: 0.8rem;
            color: #94a3b8;
            text-transform: uppercase;
        }

        .admin-priority-tasks {
            margin-top: 20px;
        }

        .admin-priority-task {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            margin-bottom: 8px;
            background: rgba(51, 65, 85, 0.6);
            border: 1px solid rgba(75, 85, 99, 0.5);
            border-radius: 8px;
            transition: all 0.2s ease;
            font-size: 0.85rem;
        }

        .admin-priority-task:hover {
            background: rgba(51, 65, 85, 0.8);
            transform: translateX(4px);
        }

        .admin-task-icon {
            font-size: 1rem;
            width: 25px;
            text-align: center;
        }

        .admin-task-content {
            flex: 1;
        }

        .admin-task-title {
            font-weight: bold;
            color: #f8fafc;
            margin-bottom: 3px;
        }

        .admin-task-meta {
            color: #94a3b8;
            font-size: 0.75rem;
        }

        .admin-task-status {
            font-size: 0.7rem;
            padding: 3px 8px;
            border-radius: 6px;
            font-weight: bold;
            white-space: nowrap;
        }

        .status-new, .status-in-progress { background: rgba(59, 130, 246, 0.2); color: #3b82f6; border: 1px solid #3b82f6; }
        .status-returned { background: rgba(245, 158, 11, 0.2); color: #f59e0b; border: 1px solid #f59e0b; }
        .status-completed { background: rgba(16, 185, 129, 0.2); color: #059669; border: 1px solid #059669; }
        .status-overdue { background: rgba(239, 68, 68, 0.2); color: #ef4444; border: 1px solid #ef4444; }

        .priority-warning { /* Styl dla zadań do pilnego sprawdzenia */ }
        .priority-urgent { /* Styl dla zadań krytycznych */ }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .kanban-board {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .header {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }

            .header h1 {
                font-size: 1.5rem;
                text-align: center;
                min-width: auto;
            }

            .controls {
                width: 100%;
                justify-content: center;
                min-width: auto;
            }

            .custom-select {
                flex: 1;
                min-width: 120px;
            }

            .kanban-column {
                padding: 15px;
                min-height: 400px;
            }

            .task-card {
                padding: 12px;
            }

            .task-actions {
                gap: 8px;
            }

            .task-action-btn {
                padding: 8px;
                min-width: 36px;
                min-height: 36px;
                pointer-events: auto;
            }

            .task-card.mobile-drag-mode .task-actions {
                pointer-events: none;
            }

            .task-card.mobile-drag-mode .task-action-btn {
                pointer-events: none;
            }

            .modal-content {
                padding: 20px;
                width: 95%;
            }

            .widget-container {
                margin-top: 15px;
                padding: 15px;
            }
            .admin-widget-container {
                padding: 15px;
            }
            .admin-stats-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 480px) {
            .controls {
                flex-direction: column;
                width: 100%;
            }

            .custom-select, .btn {
                width: 100%;
            }

            .btn {
                padding: 15px;
                font-size: 16px;
            }
            .admin-stats-grid {
                grid-template-columns: 1fr;
            }
            .admin-priority-task {
                flex-wrap: wrap;
                text-align: center;
            }
            .admin-task-icon, .admin-task-status {
                margin-bottom: 5px;
            }
            .admin-task-meta {
                display: block;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1><i class="fas fa-tasks"></i> To-Do Kanban Board</h1>
            <div class="controls">
                <select id="locationFilter" class="custom-select">
                    <option value="all">Wszystkie lokalizacje</option>
                    <option value="20004014">BAZA 20004014</option>
                    <option value="20004015">BAZA 20004015</option>
                </select>
                <select id="userFilter" class="custom-select">
                    <option value="all">Wszyscy użytkownicy</option>
                    <option value="1">Jakub Jaworowicz</option>
                    <option value="2">Anna Kowalska</option>
                    <option value="3">Piotr Nowak</option>
                </select>
                <button class="btn btn-primary" onclick="openTaskModal()">
                    <i class="fas fa-plus"></i> Dodaj zadanie
                </button>
            </div>
        </header>

        <div class="kanban-board">
            <div class="kanban-column" data-status="new">
                <div class="column-header">
                    <div class="column-title">
                        <i class="fas fa-inbox"></i>
                        Nowe
                        <span class="task-count" id="new-count">0</span>
                    </div>
                </div>
                <div class="drop-zone" id="new-tasks"></div>
            </div>

            <div class="kanban-column" data-status="in-progress">
                <div class="column-header">
                    <div class="column-title">
                        <i class="fas fa-play"></i>
                        W toku
                        <span class="task-count" id="in-progress-count">0</span>
                    </div>
                </div>
                <div class="drop-zone" id="in-progress-tasks"></div>
            </div>

            <div class="kanban-column" data-status="returned">
                <div class="column-header">
                    <div class="column-title">
                        <i class="fas fa-undo"></i>
                        Zwrócone
                        <span class="task-count" id="returned-count">0</span>
                    </div>
                </div>
                <div class="drop-zone" id="returned-tasks"></div>
            </div>

            <div class="kanban-column" data-status="completed">
                <div class="column-header">
                    <div class="column-title">
                        <i class="fas fa-check"></i>
                        Zakończone
                        <span class="task-count" id="completed-count">0</span>
                    </div>
                </div>
                <div class="drop-zone" id="completed-tasks"></div>
            </div>
        </div>

        <!-- Widget responsywny -->
        <div class="widget-container">
            <h3 class="widget-title">
                <i class="fas fa-list-check"></i> 
                Moje zadania do wykonania
            </h3>
            <div class="widget-tasks" id="widget-tasks"></div>
        </div>

        <!-- Widget Administratora/Superadministratora -->
        <div class="admin-widget-container" id="admin-widget">
            <h3 class="admin-widget-title">
                <i class="fas fa-shield-alt"></i> 
                Panel Administratora / Superadministratora
            </h3>
            <div class="admin-stats-grid">
                <div class="admin-stat-card">
                    <span class="admin-stat-value" id="stat-new">0</span>
                    <span class="admin-stat-label">Nowe zadania</span>
                </div>
                <div class="admin-stat-card">
                    <span class="admin-stat-value" id="stat-progress">0</span>
                    <span class="admin-stat-label">W toku</span>
                </div>
                <div class="admin-stat-card">
                    <span class="admin-stat-value" id="stat-returned">0</span>
                    <span class="admin-stat-label">Zwrócone</span>
                </div>
                <div class="admin-stat-card">
                    <span class="admin-stat-value" id="stat-completed">0</span>
                    <span class="admin-stat-label">Zakończone</span>
                </div>
            </div>
            <div class="admin-widget-title">
                <i class="fas fa-bell"></i> 
                Zadania wymagające uwagi
            </div>
            <div class="admin-priority-tasks" id="admin-priority-tasks">
                <!-- Tutaj będą ładowane zadania wymagające uwagi -->
            </div>
        </div>
    </div>

    <!-- Modal dodawania/edycji zadania -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Dodaj nowe zadanie</h2>
                <button type="button" class="close-btn" onclick="closeTaskModal()">&times;</button>
            </div>
            <form id="taskForm">
                <div class="form-group">
                    <label class="form-label">Tytuł zadania *</label>
                    <input type="text" id="taskTitle" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Opis</label>
                    <textarea id="taskDescription" class="form-textarea"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Typ przypisania *</label>
                    <select id="taskAssignmentType" class="form-select" required onchange="toggleUserSelect()">
                        <option value="">Wybierz typ</option>
                        <option value="global">Globalne (dla wszystkich w lokalizacji)</option>
                        <option value="user">Dla konkretnego użytkownika</option>
                        <option value="self">Tylko dla siebie</option>
                    </select>
                </div>
                <div class="form-group" id="userSelectGroup" style="display: none;">
                    <label class="form-label">Użytkownik</label>
                    <select id="taskAssignedUser" class="form-select">
                        <option value="1">Jakub Jaworowicz</option>
                        <option value="2">Anna Kowalska</option>
                        <option value="3">Piotr Nowak</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Lokalizacja</label>
                    <select id="taskLocation" class="form-select">
                        <option value="20004014">BAZA 20004014</option>
                        <option value="20004015">BAZA 20004015</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Termin wykonania</label>
                    <input type="date" id="taskDueDate" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Priorytet</label>
                    <select id="taskPriority" class="form-select">
                        <option value="low">Niski</option>
                        <option value="medium">Średni</option>
                        <option value="high">Wysoki</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select id="taskStatus" class="form-select">
                        <option value="new">Nowe</option>
                        <option value="in-progress">W toku</option>
                        <option value="returned">Zwrócone</option>
                        <option value="completed">Zakończone</option>
                    </select>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Zapisz zadanie
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeTaskModal()">
                        <i class="fas fa-times"></i> Anuluj
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal potwierdzenia -->
    <div id="confirmModal" class="confirm-modal">
        <div class="confirm-modal-content">
            <h3 class="confirm-modal-title">
                <i class="fas fa-exclamation-triangle"></i>
                Potwierdź działanie
            </h3>
            <p class="confirm-modal-text" id="confirmModalText"></p>
            <div class="confirm-modal-actions">
                <button type="button" class="btn btn-danger" id="confirmModalOk">
                    <i class="fas fa-check"></i> Tak
                </button>
                <button type="button" class="btn btn-secondary" onclick="closeConfirmModal()">
                    <i class="fas fa-times"></i> Nie
                </button>
            </div>
        </div>
    </div>

    <script>
        // Helper function to escape HTML
        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return unsafe
                 .replace(/&/g, "&amp;")
                 .replace(/</g, "&lt;")
                 .replace(/>/g, "&gt;")
                 .replace(/"/g, "&quot;")
                 .replace(/'/g, "&#039;");
        }

        // Globalne zmienne
        let tasks = [];
        let editingTaskId = null;
        let currentUser = 1; // Symulacja aktualnego użytkownika
        let confirmCallback = null;
        let dragStartTime = 0;
        let isDragging = false;

        // Inicjalizacja
        document.addEventListener('DOMContentLoaded', function() {
            loadTasks();
            renderTasks();
            renderWidget();
            setupDragAndDrop();
            setupTouchEvents();
            // Ustawienie domyślnego filtra użytkownika na bieżącego użytkownika
            document.getElementById('userFilter').value = currentUser;
            // Symulacja admina dla demonstracji
            if (currentUser === 1) { // Zakładamy, że użytkownik 1 to administrator
                document.getElementById('admin-widget').style.display = 'block';
            }
        });

        // Modal potwierdzenia
        function showConfirm(message, callback) {
            document.getElementById('confirmModalText').textContent = message;
            document.getElementById('confirmModal').style.display = 'block';
            confirmCallback = callback;
        }

        function closeConfirmModal() {
            document.getElementById('confirmModal').style.display = 'none';
            confirmCallback = null;
        }

        document.getElementById('confirmModalOk').addEventListener('click', function() {
            if (confirmCallback) {
                confirmCallback();
            }
            closeConfirmModal();
        });

        // Funkcje pomocnicze dla dat
        function formatDueDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            date.setHours(0, 0, 0, 0);

            const diffTime = date - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            if (diffDays < 0) {
                return `Przeterminowane (${Math.abs(diffDays)} dni)`;
            } else if (diffDays === 0) {
                return 'Dziś ostatni dzień!';
            } else if (diffDays === 1) {
                return 'Jutro';
            } else {
                return `Za ${diffDays} dni`;
            }
        }

        function getDueDateClass(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            date.setHours(0, 0, 0, 0);

            const diffTime = date - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            if (diffDays < 0) {
                return 'due-overdue';
            } else if (diffDays === 0) {
                return 'due-today';
            }
            return '';
        }

        // Zarządzanie zadaniami
        function loadTasks() {
            const savedTasks = localStorage.getItem('kanban_tasks');
            if (savedTasks) {
                tasks = JSON.parse(savedTasks);
            } else {
                // Przykładowe zadania z terminami
                const today = new Date();
                const tomorrow = new Date(today);
                tomorrow.setDate(today.getDate() + 1);
                const yesterday = new Date(today);
                yesterday.setDate(today.getDate() - 1);

                tasks = [
                    {
                        id: 1,
                        title: 'Sprawdzenie sprzętu technicznego',
                        description: 'Kontrola stanu technicznego urządzeń w lokalizacji',
                        assignmentType: 'global',
                        assignedUser: null,
                        location: '20004014',
                        priority: 'high',
                        status: 'new',
                        dueDate: today.toISOString().split('T')[0],
                        createdBy: 1,
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 2,
                        title: 'Przygotowanie raportu miesięcznego',
                        description: 'Sporządzenie raportu z wyników za bieżący miesiąc',
                        assignmentType: 'user',
                        assignedUser: 2,
                        location: '20004014',
                        priority: 'medium',
                        status: 'in-progress',
                        dueDate: tomorrow.toISOString().split('T')[0],
                        createdBy: 1,
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 3,
                        title: 'Aktualizacja bazy klientów',
                        description: 'Weryfikacja i aktualizacja danych kontaktowych',
                        assignmentType: 'self',
                        assignedUser: 1,
                        location: '20004014',
                        priority: 'low',
                        status: 'completed',
                        dueDate: yesterday.toISOString().split('T')[0],
                        createdBy: 1,
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 4,
                        title: 'Korekta faktury nr 123/2024',
                        description: 'Błąd w naliczonej kwocie VAT',
                        assignmentType: 'user',
                        assignedUser: 1,
                        location: '20004015',
                        priority: 'high',
                        status: 'returned',
                        dueDate: yesterday.toISOString().split('T')[0],
                        createdBy: 2,
                        createdAt: new Date().toISOString()
                    }
                ];
                saveTasks();
            }
        }

        function saveTasks() {
            localStorage.setItem('kanban_tasks', JSON.stringify(tasks));
        }

        function renderTasks() {
            const columns = {
                'new': document.getElementById('new-tasks'),
                'in-progress': document.getElementById('in-progress-tasks'),
                'returned': document.getElementById('returned-tasks'),
                'completed': document.getElementById('completed-tasks')
            };

            // Wyczyść kolumny
            Object.values(columns).forEach(column => {
                column.innerHTML = '';
            });

            // Filtruj zadania
            const filteredTasks = getFilteredTasks();

            // Renderuj zadania
            filteredTasks.forEach(task => {
                const taskElement = createTaskElement(task);
                columns[task.status].appendChild(taskElement);
            });

            // Aktualizuj liczniki
            updateTaskCounts();
        }

        function getFilteredTasks() {
            const locationFilter = document.getElementById('locationFilter').value;
            const userFilter = document.getElementById('userFilter').value;

            return tasks.filter(task => {
                // Filtr lokalizacji
                if (locationFilter !== 'all' && task.location !== locationFilter) {
                    return false;
                }

                // Filtr użytkownika
                if (userFilter !== 'all') {
                    const userId = parseInt(userFilter);
                    // Zadanie jest widoczne, jeśli jest przypisane do wybranego użytkownika
                    // lub jest typu globalne (widoczne dla wszystkich)
                    if (task.assignmentType === 'global') {
                        // Globalne zadania są widoczne dla wszystkich
                    } else if (task.assignmentType === 'user' && task.assignedUser !== userId) {
                        return false;
                    } else if (task.assignmentType === 'self' && task.assignedUser !== userId) {
                        return false;
                    } else if (task.assignmentType !== 'self' && task.assignmentType !== 'user' && task.assignmentType !== 'global') {
                         // Obsługa nieznanych typów przypisania, jeśli istnieją
                        return false;
                    }
                }

                return true;
            });
        }

        function createTaskElement(task) {
            const taskDiv = document.createElement('div');
            taskDiv.className = 'task-card';
            taskDiv.draggable = true;
            taskDiv.dataset.taskId = task.id;

            const assignmentTypeClass = `type-${task.assignmentType}`;
            const assignmentTypeText = {
                'global': 'Globalne',
                'user': 'Użytkownik',
                'self': 'Własne'
            }[task.assignmentType] || task.assignmentType; // Fallback for safety

            const userName = task.assignedUser ? getUserName(task.assignedUser) : 'Wszyscy';
            const dueDateClass = getDueDateClass(task.dueDate);

            if (dueDateClass) {
                taskDiv.classList.add(dueDateClass);
            }

            const dueDateHtml = task.dueDate ? `
                <div class="task-due-date ${dueDateClass}">
                    <i class="fas fa-calendar"></i> ${formatDueDate(task.dueDate)}
                </div>
            ` : '';

            taskDiv.innerHTML = `
                <div class="task-priority priority-${task.priority}"></div>
                <div class="task-title">${escapeHtml(task.title)}</div>
                <div class="task-description">${escapeHtml(task.description || '')}</div>
                <div class="task-meta">
                    <div class="task-assignee">
                        <span class="assignee-type ${assignmentTypeClass}">${assignmentTypeText}</span>
                        <span>${userName}</span>
                    </div>
                    <div>ID: ${task.location}</div>
                </div>
                ${dueDateHtml}
                <div class="task-actions">
                    <button class="task-action-btn btn-edit" onclick="event.stopPropagation(); editTask(${task.id})">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="task-action-btn btn-delete" onclick="event.stopPropagation(); deleteTask(${task.id})">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;

            return taskDiv;
        }

        function getUserName(userId) {
            const users = {
                1: 'Jakub Jaworowicz',
                2: 'Anna Kowalska',
                3: 'Piotr Nowak'
            };
            return users[userId] || 'Nieznany';
        }

        function updateTaskCounts() {
            const filteredTasks = getFilteredTasks();
            const counts = {
                'new': 0,
                'in-progress': 0,
                'returned': 0,
                'completed': 0
            };

            filteredTasks.forEach(task => {
                counts[task.status]++;
            });

            Object.keys(counts).forEach(status => {
                const countElement = document.getElementById(`${status}-count`);
                if (countElement) {
                    countElement.textContent = counts[status];
                }
            });
        }

        // Modal zarządzanie
        function openTaskModal(taskId = null) {
            editingTaskId = taskId;
            const modal = document.getElementById('taskModal');
            const title = document.getElementById('modalTitle');

            if (taskId) {
                title.textContent = 'Edytuj zadanie';
                const task = tasks.find(t => t.id === taskId);
                if (task) {
                    document.getElementById('taskTitle').value = task.title;
                    document.getElementById('taskDescription').value = task.description;
                    document.getElementById('taskAssignmentType').value = task.assignmentType;
                    document.getElementById('taskAssignedUser').value = task.assignedUser || '';
                    document.getElementById('taskLocation').value = task.location;
                    document.getElementById('taskDueDate').value = task.dueDate || '';
                    document.getElementById('taskPriority').value = task.priority;
                    document.getElementById('taskStatus').value = task.status;
                    toggleUserSelect();
                }
            } else {
                title.textContent = 'Dodaj nowe zadanie';
                document.getElementById('taskForm').reset();
                document.getElementById('userSelectGroup').style.display = 'none'; // Reset user select visibility
            }

            modal.style.display = 'block';
        }

        function closeTaskModal() {
            document.getElementById('taskModal').style.display = 'none';
            editingTaskId = null;
        }

        function toggleUserSelect() {
            const assignmentType = document.getElementById('taskAssignmentType').value;
            const userSelectGroup = document.getElementById('userSelectGroup');

            if (assignmentType === 'user') {
                userSelectGroup.style.display = 'block';
            } else {
                userSelectGroup.style.display = 'none';
            }
        }

        // Obsługa formularza
        document.getElementById('taskForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const formData = {
                title: document.getElementById('taskTitle').value,
                description: document.getElementById('taskDescription').value,
                assignmentType: document.getElementById('taskAssignmentType').value,
                assignedUser: document.getElementById('taskAssignedUser').value || null,
                location: document.getElementById('taskLocation').value,
                dueDate: document.getElementById('taskDueDate').value || '', // Changed to empty string if null
                priority: document.getElementById('taskPriority').value,
                status: document.getElementById('taskStatus').value
            };

            if (formData.assignmentType === 'self') {
                formData.assignedUser = currentUser;
            } else if (formData.assignmentType === 'global') {
                formData.assignedUser = null;
            } else if (formData.assignmentType === 'user') {
                formData.assignedUser = parseInt(formData.assignedUser);
            }

            if (editingTaskId) {
                // Edycja zadania
                const taskIndex = tasks.findIndex(t => t.id === editingTaskId);
                if (taskIndex !== -1) {
                    tasks[taskIndex] = { ...tasks[taskIndex], ...formData };
                }
            } else {
                // Dodanie nowego zadania
                const newTask = {
                    id: Date.now(),
                    ...formData,
                    createdBy: currentUser,
                    createdAt: new Date().toISOString()
                };
                tasks.push(newTask);
            }

            saveTasks();
            renderTasks();
            renderWidget();
            closeTaskModal();
        });

        function editTask(taskId) {
            openTaskModal(taskId);
        }

        function deleteTask(taskId) {
            showConfirm('Czy na pewno chcesz usunąć to zadanie?', function() {
                tasks = tasks.filter(t => t.id !== taskId);
                saveTasks();
                renderTasks();
                renderWidget();
            });
        }

        // Drag & Drop with improved mobile support
        let draggedElement = null;
        let initialX = 0;
        let initialY = 0;
        let currentX = 0;
        let currentY = 0;

        function setupDragAndDrop() {
            const columns = document.querySelectorAll('.drop-zone');

            columns.forEach(column => {
                column.addEventListener('dragover', handleDragOver);
                column.addEventListener('drop', handleDrop);
                column.addEventListener('dragenter', handleDragEnter);
                column.addEventListener('dragleave', handleDragLeave);
            });

            document.addEventListener('dragstart', handleDragStart);
            document.addEventListener('dragend', handleDragEnd);
        }

        function setupTouchEvents() {
            document.addEventListener('touchstart', handleTouchStart, { passive: false });
            document.addEventListener('touchmove', handleTouchMove, { passive: false });
            document.addEventListener('touchend', handleTouchEnd, { passive: false });
        }

        function handleTouchStart(e) {
            const target = e.target.closest('.task-card');
            if (target && !e.target.closest('.task-action-btn')) {
                dragStartTime = Date.now();
                isDragging = false;

                draggedElement = target;
                const touch = e.touches[0];
                initialX = touch.clientX;
                initialY = touch.clientY;
                currentX = touch.clientX;
                currentY = touch.clientY;

                // Opóźnienie przed rozpoczęciem przeciągania
                setTimeout(() => {
                    if (draggedElement && !isDragging) {
                        isDragging = true;
                        target.classList.add('dragging', 'mobile-drag-mode');
                        target.style.position = 'fixed';
                        target.style.zIndex = '1000';
                        target.style.pointerEvents = 'none';
                        target.style.transform = 'rotate(3deg) scale(1.05)';
                        target.style.left = (currentX - 50) + 'px';
                        target.style.top = (currentY - 50) + 'px';
                    }
                }, 200);
            }
        }

        function handleTouchMove(e) {
            if (!draggedElement) return;

            const touch = e.touches[0];
            currentX = touch.clientX;
            currentY = touch.clientY;

            const deltaX = Math.abs(currentX - initialX);
            const deltaY = Math.abs(currentY - initialY);

            // Rozpocznij przeciąganie jeśli ruch jest większy niż 10px
            if ((deltaX > 10 || deltaY > 10) && !isDragging) {
                isDragging = true;
                draggedElement.classList.add('dragging', 'mobile-drag-mode');
                draggedElement.style.position = 'fixed';
                draggedElement.style.zIndex = '1000';
                draggedElement.style.pointerEvents = 'none';
                draggedElement.style.transform = 'rotate(3deg) scale(1.05)';
            }

            if (isDragging) {
                e.preventDefault();

                draggedElement.style.left = (currentX - 50) + 'px';
                draggedElement.style.top = (currentY - 50) + 'px';

                // Znajdź kolumnę pod palcem
                const elementBelow = document.elementFromPoint(currentX, currentY);
                const dropZone = elementBelow?.closest('.drop-zone');

                // Usuń poprzednie podświetlenia
                document.querySelectorAll('.drop-zone').forEach(zone => {
                    zone.classList.remove('drag-over');
                });

                // Dodaj podświetlenie do aktualnej kolumny
                if (dropZone) {
                    dropZone.classList.add('drag-over');
                }
            }
        }

        function handleTouchEnd(e) {
            if (!draggedElement) return;

            // Jeśli nie było przeciągania, pozwól na normalne kliknięcia
            if (!isDragging) {
                draggedElement = null;
                return;
            }

            e.preventDefault();

            // Znajdź kolumnę pod miejscem puszczenia
            const elementBelow = document.elementFromPoint(currentX, currentY);
            const dropZone = elementBelow?.closest('.drop-zone');

            if (dropZone) {
                const newStatus = dropZone.id.replace('-tasks', '');
                const taskId = parseInt(draggedElement.dataset.taskId);
                const task = tasks.find(t => t.id === taskId);

                if (task && task.status !== newStatus) {
                    task.status = newStatus;
                    saveTasks();
                    renderTasks();
                    renderWidget();
                }
            }

            // Przywróć element do normalnego stanu
            draggedElement.classList.remove('dragging', 'mobile-drag-mode');
            draggedElement.style.position = '';
            draggedElement.style.zIndex = '';
            draggedElement.style.pointerEvents = '';
            draggedElement.style.transform = '';
            draggedElement.style.left = '';
            draggedElement.style.top = '';

            // Usuń podświetlenia
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.classList.remove('drag-over');
            });

            draggedElement = null;
            isDragging = false;
        }

        function handleDragStart(e) {
            if (e.target.classList.contains('task-card')) {
                e.target.classList.add('dragging');
                e.dataTransfer.setData('text/plain', e.target.dataset.taskId);
            }
        }

        function handleDragEnd(e) {
            if (e.target.classList.contains('task-card')) {
                e.target.classList.remove('dragging');
            }
        }

        function handleDragOver(e) {
            e.preventDefault();
        }

        function handleDragEnter(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');

            const taskId = parseInt(e.dataTransfer.getData('text/plain'));
            const newStatus = e.currentTarget.id.replace('-tasks', '');

            const task = tasks.find(t => t.id === taskId);
            if (task && task.status !== newStatus) {
                task.status = newStatus;
                saveTasks();
                renderTasks();
                renderWidget();
            }
        }

        // Widget
        function renderWidget() {
            renderUserWidget();
            renderAdminWidget();
        }

        function renderUserWidget() {
            const widgetContainer = document.getElementById('widget-tasks');
            const myTasks = tasks.filter(task => {
                // Filtruj zadania przypisane do użytkownika
                return (task.assignmentType === 'self' && task.assignedUser === currentUser) ||
                       (task.assignmentType === 'user' && task.assignedUser === currentUser) ||
                       (task.assignmentType === 'global');
            });

            widgetContainer.innerHTML = '';

            if (myTasks.length === 0) {
                widgetContainer.innerHTML = '<p style="color: #94a3b8; text-align: center; padding: 20px;">Brak zadań do wykonania</p>';
                return;
            }

            myTasks.forEach(task => {
                const taskDiv = document.createElement('div');
                taskDiv.className = 'widget-task';

                const dueDateClass = getDueDateClass(task.dueDate);
                if (dueDateClass) {
                    taskDiv.classList.add(dueDateClass);
                }

                const dueDateHtml = task.dueDate ? `
                    <div class="widget-task-due ${dueDateClass}">
                        ${formatDueDate(task.dueDate)}
                    </div>
                ` : '';

                taskDiv.innerHTML = `
                    <label class="custom-checkbox">
                        <input type="checkbox" ${task.status === 'completed' ? 'checked' : ''} 
                               onchange="toggleTaskCompletion(${task.id}, this.checked)">
                        <span class="checkbox-checkmark"></span>
                    </label>
                    <div class="widget-task-text ${task.status === 'completed' ? 'completed' : ''}">
                        <strong>${escapeHtml(task.title)}</strong>
                        <small>${escapeHtml(task.description || '')}</small>
                        ${dueDateHtml}
                    </div>
                    <span class="assignee-type type-${task.assignmentType}">${task.assignmentType}</span>
                `;

                widgetContainer.appendChild(taskDiv);
            });
        }

        function renderAdminWidget() {
            // Widget admina pokazuje się zawsze w mockup dla demonstracji
            const adminWidget = document.getElementById('admin-widget');
            // Sprawdzenie czy użytkownik jest adminem (tutaj zakładamy, że currentUser === 1 jest adminem)
            if (currentUser === 1) {
                adminWidget.style.display = 'block';
            } else {
                adminWidget.style.display = 'none';
                return; // Jeśli nie jest adminem, nie renderujemy tego widgetu
            }

            // Statystyki
            const stats = {
                new: tasks.filter(t => t.status === 'new').length,
                progress: tasks.filter(t => t.status === 'in-progress').length,
                returned: tasks.filter(t => t.status === 'returned').length,
                completed: tasks.filter(t => t.status === 'completed').length
            };

            document.getElementById('stat-new').textContent = stats.new;
            document.getElementById('stat-progress').textContent = stats.progress;
            document.getElementById('stat-returned').textContent = stats.returned;
            document.getElementById('stat-completed').textContent = stats.completed;

            // Zadania wymagające uwagi
            const priorityTasks = tasks.filter(task => {
                const dueDateClass = getDueDateClass(task.dueDate);
                return task.status === 'returned' || dueDateClass === 'due-overdue' || dueDateClass === 'due-today';
            });

            const priorityContainer = document.getElementById('admin-priority-tasks');
            priorityContainer.innerHTML = '';

            if (priorityTasks.length === 0) {
                priorityContainer.innerHTML = '<p style="color: #94a3b8; text-align: center; padding: 15px; font-size: 0.8rem;">Brak zadań wymagających uwagi</p>';
                return;
            }

            priorityTasks.forEach(task => {
                const taskDiv = document.createElement('div');
                taskDiv.className = 'admin-priority-task';

                const dueDateClass = getDueDateClass(task.dueDate);
                let statusClass = '';
                let icon = 'fas fa-info-circle';

                if (task.status === 'returned') {
                    statusClass = 'status-returned';
                    icon = 'fas fa-undo';
                } else if (dueDateClass === 'due-overdue') {
                    statusClass = 'status-overdue';
                    icon = 'fas fa-exclamation-triangle';
                } else if (dueDateClass === 'due-today') {
                    statusClass = 'status-warning'; // Placeholder, needs actual definition if used
                    icon = 'fas fa-clock';
                } else {
                    // Default status for other cases if needed
                    statusClass = 'status-new'; // Or 'status-in-progress'
                }

                // Ensure statusClass is one of the defined ones or a default
                const validStatusClasses = ['status-new', 'status-in-progress', 'status-returned', 'status-completed', 'status-overdue'];
                if (!validStatusClasses.includes(statusClass)) {
                    // If the determined class isn't valid, assign a default based on task status
                    if (task.status === 'new') statusClass = 'status-new';
                    else if (task.status === 'in-progress') statusClass = 'status-in-progress';
                    else if (task.status === 'completed') statusClass = 'status-completed';
                    else statusClass = 'status-new'; // Fallback
                }


                const statusText = {
                    'returned': 'Zwrócone',
                    'new': 'Nowe',
                    'in-progress': 'W toku',
                    'completed': 'Zakończone'
                }[task.status];

                const assigneeText = task.assignmentType === 'global' ? 'Globalne' :
                                   task.assignmentType === 'self' ? 'Własne' :
                                   getUserName(task.assignedUser);

                taskDiv.innerHTML = `
                    <div class="admin-task-icon">
                        <i class="${icon}"></i>
                    </div>
                    <div class="admin-task-content">
                        <div class="admin-task-title">${escapeHtml(task.title)}</div>
                        <div class="admin-task-meta">
                            ${assigneeText} • ${task.location || 'Brak lokalizacji'}
                            ${task.dueDate ? ' • ' + formatDueDate(task.dueDate) : ''}
                        </div>
                    </div>
                    <div class="admin-task-status ${statusClass}">${statusText}</div>
                `;

                priorityContainer.appendChild(taskDiv);
            });
        }


        // This function needs to be defined as it's called in the HTML.
        // It's likely intended to update the task's status in the main list
        // and in the widget.
        function toggleTaskCompletion(taskId, isCompleted) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                // Changed logic: if unchecked, it goes to 'returned', not 'new'
                task.status = isCompleted ? 'completed' : 'returned';
                saveTasks();
                renderTasks();
                renderWidget();
            }
        }

        // Filtry
        function setupFilters() {
            document.getElementById('locationFilter').addEventListener('change', renderTasks);
            document.getElementById('userFilter').addEventListener('change', renderTasks);
        }

        // Zamykanie modali przy kliknięciu na tło
        window.onclick = function(event) {
            const taskModal = document.getElementById('taskModal');
            const confirmModal = document.getElementById('confirmModal');

            if (event.target === taskModal) {
                closeTaskModal();
            }
            if (event.target === confirmModal) {
                closeConfirmModal();
            }
        }
    </script>
</body>
</html>